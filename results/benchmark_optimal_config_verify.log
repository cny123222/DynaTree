`torch_dtype` is deprecated! Use `dtype` instead!

======================================================================
  åŠ è½½æ¨¡å‹
======================================================================
  Target: /mnt/disk1/models/pythia-2.8b
  Draft: /mnt/disk1/models/pythia-70m

======================================================================
  Warmup (10 runs)
======================================================================
  Warmup 1/10 å®Œæˆ
  Warmup 2/10 å®Œæˆ
  Warmup 3/10 å®Œæˆ
  Warmup 4/10 å®Œæˆ
  Warmup 5/10 å®Œæˆ
  Warmup 6/10 å®Œæˆ
  Warmup 7/10 å®Œæˆ
  Warmup 8/10 å®Œæˆ
  Warmup 9/10 å®Œæˆ
  Warmup 10/10 å®Œæˆ

======================================================================
  æ€§èƒ½æµ‹è¯•: 500 tokens, 5 runs
======================================================================
  Tree V2 é…ç½®: D=8, B=3, t=0.03

[1/7] Baseline (çº¯è‡ªå›å½’)...
    Run 1: 500 tokens, 4.14s, 120.8 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 4.11s, 121.7 t/s 
    Run 3: 500 tokens, 4.12s, 121.5 t/s 
    Run 4: 500 tokens, 4.11s, 121.6 t/s 
    Run 5: 500 tokens, 4.07s, 122.9 t/s 
  >>> å¹³å‡: 121.9 t/s (1.00x)

[2/7] HuggingFace Assisted Generation...
    Run 1: 500 tokens, 3.12s, 160.4 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.08s, 162.3 t/s 
    Run 3: 500 tokens, 3.06s, 163.3 t/s 
    Run 4: 500 tokens, 3.06s, 163.2 t/s 
    Run 5: 500 tokens, 3.08s, 162.4 t/s 
  >>> å¹³å‡: 162.8 t/s (1.34x)

[3/7] Linear Spec Decode K=5...
    Run 1: 500 tokens, 4.69s, 106.7 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 4.00s, 125.1 t/s 
    Run 3: 500 tokens, 4.00s, 125.1 t/s 
    Run 4: 500 tokens, 3.99s, 125.4 t/s 
    Run 5: 500 tokens, 3.99s, 125.2 t/s 
  >>> å¹³å‡: 125.2 t/s (1.03x)
      æ¥å—ç‡: 72.5%, æ¯è½® tokens: 3.62

[3/7] Linear Spec Decode K=6...
    Run 1: 500 tokens, 4.02s, 124.3 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.76s, 133.0 t/s 
    Run 3: 500 tokens, 3.76s, 132.8 t/s 
    Run 4: 500 tokens, 3.75s, 133.2 t/s 
    Run 5: 500 tokens, 3.74s, 133.7 t/s 
  >>> å¹³å‡: 133.2 t/s (1.09x)
      æ¥å—ç‡: 68.3%, æ¯è½® tokens: 4.10

[3/7] Linear Spec Decode K=7...
    Run 1: 500 tokens, 3.88s, 129.0 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.82s, 130.9 t/s 
    Run 3: 500 tokens, 5.10s, 98.0 t/s 
    Run 4: 500 tokens, 7.37s, 67.8 t/s 
    Run 5: 500 tokens, 5.71s, 87.6 t/s 
  >>> å¹³å‡: 96.1 t/s (0.79x)
      æ¥å—ç‡: 61.6%, æ¯è½® tokens: 4.31

[3/7] Linear Spec Decode K=8...
    Run 1: 500 tokens, 3.87s, 129.1 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.83s, 130.5 t/s 
    Run 3: 500 tokens, 3.83s, 130.7 t/s 
    Run 4: 500 tokens, 3.82s, 130.8 t/s 
    Run 5: 500 tokens, 3.82s, 130.9 t/s 
  >>> å¹³å‡: 130.7 t/s (1.07x)
      æ¥å—ç‡: 55.8%, æ¯è½® tokens: 4.46

[4/7] Tree V2 (D=8 B=3 t=0.03)...
    Run 1: 500 tokens, 2.77s, 180.5 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 2.55s, 196.3 t/s 
    Run 3: 500 tokens, 2.53s, 197.5 t/s 
    Run 4: 500 tokens, 2.55s, 196.3 t/s 
    Run 5: 500 tokens, 2.54s, 197.2 t/s 
  >>> å¹³å‡: 196.8 t/s (1.61x)
      æ¥å—ç‡: 29.6%, å¹³å‡è·¯å¾„é•¿åº¦: 0.00

[5/7] StreamingLLM + Spec Decode (cache=512)...
    Run 1: 500 tokens, 3.88s, 129.0 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.88s, 128.7 t/s 
    Run 3: 500 tokens, 3.87s, 129.2 t/s 
    Run 4: 500 tokens, 3.89s, 128.4 t/s 
    Run 5: 500 tokens, 3.90s, 128.1 t/s 
  >>> å¹³å‡: 128.6 t/s (1.05x)
      æ¥å—ç‡: 65.6%, å‹ç¼©æ¬¡æ•°: 0

[5/7] StreamingLLM + Spec Decode (cache=1024)...
    Run 1: 500 tokens, 3.74s, 133.7 t/s (warmup, è·³è¿‡)
    Run 2: 500 tokens, 3.74s, 133.8 t/s 
    Run 3: 500 tokens, 3.73s, 133.9 t/s 
    Run 4: 500 tokens, 3.73s, 134.1 t/s 
    Run 5: 500 tokens, 3.71s, 134.8 t/s 
  >>> å¹³å‡: 134.2 t/s (1.10x)
      æ¥å—ç‡: 68.3%, å‹ç¼©æ¬¡æ•°: 0

[6/7] Tree + StreamingLLM (D=8 B=3 cache=1024)...

[6/7] Tree + StreamingLLM - é”™è¯¯: TreeStreamingSpeculativeGenerator.__init__() got an unexpected keyword argument 'probability_threshold'

======================================================================
  ğŸ“Š ç»“æœæ±‡æ€»
======================================================================

æ’å   æ–¹æ³•                                           ååé‡        åŠ é€Ÿæ¯”
-----------------------------------------------------------------
ğŸ¥‡1   Tree V2 D=8B=3t=0.03                     196.8 t/s     1.61x
ğŸ¥ˆ2   HF Assisted                              162.8 t/s     1.34x
ğŸ¥‰3   Streaming K=6 cache=1024                 134.2 t/s     1.10x
  4   Linear K=6                               133.2 t/s     1.09x
  5   Linear K=8                               130.7 t/s     1.07x
  6   Streaming K=6 cache=512                  128.6 t/s     1.05x
  7   Linear K=5                               125.2 t/s     1.03x
  8   Baseline (AR)                            121.9 t/s     1.00x
  9   Linear K=7                                96.1 t/s     0.79x

======================================================================
  ğŸ” å…³é”®å¯¹æ¯”åˆ†æ
======================================================================

é…ç½®: 500 tokens, Tree V2 (D=8, B=3, t=0.03)

æ–¹æ³•å¯¹æ¯”:
  Baseline:               121.9 t/s (1.00x)
  HF Assisted:            162.8 t/s (1.34x)
  Linear (æœ€ä½³ K):        133.2 t/s (1.09x) [Linear K=6]
  Tree V2:                196.8 t/s (1.61x)
  StreamingLLM (æœ€ä½³):    134.2 t/s (1.10x) [Streaming K=6 cache=1024]


======================================================================
  ğŸ“ ç»“è®º
======================================================================

1. æœ€å¿«æ–¹æ³•: Tree V2 D=8B=3t=0.03 (196.8 t/s, 1.61x)

2. Tree V2 vs Linear:
   - Tree V2: 196.8 t/s
   - Linear æœ€ä½³: 133.2 t/s
   - å·®å¼‚: 63.6 t/s
   - Tree V2 ä¼˜äº Linear

3. HF Assisted æ˜¾è‘—é¢†å…ˆï¼Œå› ä¸º:
   - HuggingFace å†…éƒ¨ä¼˜åŒ–æ›´å½»åº•
   - ä½¿ç”¨ C++ å®ç°çš„å…³é”®è·¯å¾„
   - æ›´é«˜æ•ˆçš„ KV cache ç®¡ç†

4. è‡ªå®šä¹‰å®ç°çš„ä»·å€¼:
   - å¯ä»¥ä¸ StreamingLLM ç»“åˆç”¨äºé•¿åºåˆ—
   - æ”¯æŒæ›´çµæ´»çš„å®šåˆ¶ (å¦‚ Tree-based)
   - é€‚åˆç ”ç©¶å’Œæ•™å­¦ç›®çš„

