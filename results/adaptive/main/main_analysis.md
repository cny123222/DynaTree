# 主实验分析 (最优配置 + 1000 Tokens)

## 实验配置

### 基础设置
| 参数 | 值 |
|------|-----|
| 目标模型 | Pythia-2.8B |
| 草稿模型 | Pythia-70m |
| 数据集 | WikiText-2 (ModelScope) |
| 样本数 | 10 |
| 热身轮数 | 2 |
| 最大提示长度 | 800 tokens |
| **生成 token 数** | **1000** |

### Adaptive 方法参数 (最优配置)
| 参数 | 值 | 说明 |
|------|-----|------|
| `high_conf_threshold` | **0.9** | 高置信度阈值 |
| `low_conf_threshold` | **0.4** | 低置信度阈值 |
| `min_branch` | **1** | 最小分支因子 |
| `max_branch` | **3** | 最大分支因子 |
| `base_depth` | 5 | 基础树深度 |
| `max_depth` | 8 | 最大树深度 |

---

## 主要结果

| 方法 | 吞吐量 (t/s) | Speedup | TTFT (ms) | TPOT (ms) | Accept% | PathLen |
|------|-------------|---------|-----------|-----------|---------|---------|
| Baseline (AR) | 131.1±0.4 | 1.00× | 18.9 | 7.61 | - | - |
| Fixed Tree (D=5, B=2) | 181.3±12.3 | 1.38× | 12.7 | 5.53 | 80.8% | 5.65 |
| Phase 1: Adaptive Branch | 176.7±36.2 | 1.35× | 13.9 | 5.98 | 77.9% | 5.45 |
| Phase 2: + Dynamic Depth | 206.0±29.8 | 1.57× | 12.5 | 4.95 | 89.6% | 6.27 |
| **Phase 3: + History Adjust** | **210.8±26.5** | **1.61×** | 12.6 | **4.81** | **94.7%** | **6.63** |

---

## 关键发现

### 1. Phase 3 全面领先 ✅

| 对比 | Phase 2 | Phase 3 | 提升 |
|------|---------|---------|------|
| 吞吐量 | 206.0 t/s | **210.8 t/s** | **+2.3%** |
| 接受率 | 89.6% | **94.7%** | **+5.1pp** |
| 路径长度 | 6.27 | **6.63** | **+5.7%** |
| TPOT | 4.95 ms | **4.81 ms** | **-2.8%** |

### 2. 相比 Fixed Tree

| 指标 | Fixed Tree | Phase 3 | 提升 |
|------|------------|---------|------|
| 吞吐量 | 181.3 t/s | 210.8 t/s | **+16.3%** |
| 接受率 | 80.8% | 94.7% | **+13.9pp** |
| Speedup | 1.38× | **1.61×** | **+16.7%** |

### 3. 相比 Baseline

- Speedup: **1.61×** (从 131.1 → 210.8 t/s)
- TPOT 降低: 7.61 → 4.81 ms (**-36.8%**)

---

## 各 Phase 贡献分析

```
Baseline:     131.1 t/s  │  -        │  -
     ↓ +Fixed Tree
Fixed Tree:   181.3 t/s  │ +38.3%    │  Accept=80.8%
     ↓ +Phase 1 (Adaptive Branch)
Phase 1:      176.7 t/s  │  -2.5%    │  Accept=77.9%  (分支开销)
     ↓ +Phase 2 (Dynamic Depth)
Phase 2:      206.0 t/s  │ +16.6%    │  Accept=89.6%  ← 动态深度贡献最大
     ↓ +Phase 3 (History Adjust)
Phase 3:      210.8 t/s  │  +2.3%    │  Accept=94.7%  ← 历史调整稳定提升
```

---

## 为什么 1000 Tokens 时 Phase 3 表现更好？

### 500 vs 1000 Tokens 对比

| 指标 | 500 Tokens | 1000 Tokens |
|------|------------|-------------|
| Phase 2 吞吐量 | 175.3 t/s | 206.0 t/s |
| Phase 3 吞吐量 | 160.9 t/s | **210.8 t/s** |
| Phase 3 vs Phase 2 | **-8.2%** | **+2.3%** ✅ |
| Phase 3 接受率 | 79.8% | **94.7%** |

### 原因

1. **历史调整需要预热**: 1000 tokens 提供足够轮次让历史机制充分发挥
2. **参数自动优化**: 更多轮次 → 更准确的接受率统计 → 更好的参数调整
3. **标准差降低**: ±45.0 (500t) → ±26.5 (1000t)，更稳定

---

## 结论

### 最终推荐

| 场景 | 推荐方法 | 预期性能 |
|------|---------|---------|
| 短回复 (<500 tokens) | Phase 2 | ~175 t/s |
| 长文本 (≥1000 tokens) | **Phase 3** | **210+ t/s, 94%+ Accept** |

### 核心贡献

1. **Phase 3 实现最高性能**: 210.8 t/s (1.61× speedup)
2. **接近完美的接受率**: 94.7%
3. **自适应优势**: 长序列场景显著优于固定树结构

---

*实验时间: 2026-01-05 | 配置: 最优参数 (0.9/0.4/1/3) | 生成长度: 1000 tokens*
