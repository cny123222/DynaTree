{
  "config": {
    "target_model": "/mnt/disk1/models/pythia-2.8b",
    "draft_model": "/mnt/disk1/models/pythia-70m",
    "dataset": "/mnt/disk1/ljm/LLM-Efficient-Reasoning/data/pg19.parquet",
    "max_new_tokens": 500,
    "num_samples": 5,
    "warmup_runs": 3
  },
  "results": [
    {
      "method": "Baseline (AR)",
      "config": {},
      "ttft_ms": 9.590819291770458,
      "tpot_ms": 7.70042570605874,
      "total_latency_ms": 3859.8036723211408,
      "throughput_tps": 129.54299887543743,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.0,
      "tokens_per_round": 0.0,
      "total_rounds": 0,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 2435727360000.0,
      "total_flops": 4972777963520.0,
      "flops_per_token": 4871454720.0,
      "peak_memory_mb": 5665.62109375,
      "speedup": 1.0
    },
    {
      "method": "Tree V2 (D=8, B=3, t=0.03)",
      "config": {
        "tree_depth": 8,
        "branch_factor": 3,
        "probability_threshold": 0.03
      },
      "ttft_ms": 10.198711417615414,
      "tpot_ms": 5.819088079035282,
      "total_latency_ms": 0.0,
      "throughput_tps": 171.24889055972693,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.6858710562414266,
      "tokens_per_round": 0.0,
      "total_rounds": 81,
      "avg_path_length": 6.172839506172839,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 5191126336143360.0,
      "total_flops": 5193663386746880.0,
      "flops_per_token": 10382252672286.72,
      "peak_memory_mb": 5713.90185546875,
      "speedup": 1.3219463193405918
    },
    {
      "method": "HF Assisted",
      "config": {
        "num_assistant_tokens": 5
      },
      "ttft_ms": 10.074601136147976,
      "tpot_ms": 6.273650799691677,
      "total_latency_ms": 0.0,
      "throughput_tps": 158.88808177569246,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.0,
      "tokens_per_round": 0.0,
      "total_rounds": 0,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 0.0,
      "decode_flops": 0.0,
      "total_flops": 0.0,
      "flops_per_token": 0.0,
      "peak_memory_mb": 5672.94287109375,
      "speedup": 1.2265277410203534
    },
    {
      "method": "Linear K=5",
      "config": {
        "K": 5
      },
      "ttft_ms": 10.000949166715145,
      "tpot_ms": 7.778372267633676,
      "total_latency_ms": 0.0,
      "throughput_tps": 128.23325587333503,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.7246376811594203,
      "tokens_per_round": 3.6231884057971016,
      "total_rounds": 138,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 3421179064320.0,
      "total_flops": 5958229667840.0,
      "flops_per_token": 6842358128.64,
      "peak_memory_mb": 5711.5869140625,
      "speedup": 0.9898895114867474
    },
    {
      "method": "Linear K=6",
      "config": {
        "K": 6
      },
      "ttft_ms": 10.19994169473648,
      "tpot_ms": 7.30767439454794,
      "total_latency_ms": 0.0,
      "throughput_tps": 136.46178287036892,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.6830601092896175,
      "tokens_per_round": 4.098360655737705,
      "total_rounds": 122,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 3629544677376.0,
      "total_flops": 6166595280896.0,
      "flops_per_token": 7259089354.752,
      "peak_memory_mb": 5709.0634765625,
      "speedup": 1.0534091695807064
    },
    {
      "method": "Linear K=7",
      "config": {
        "K": 7
      },
      "ttft_ms": 9.988298825919628,
      "tpot_ms": 7.37691954895854,
      "total_latency_ms": 0.0,
      "throughput_tps": 135.19295858847372,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.6157635467980296,
      "tokens_per_round": 4.310344827586207,
      "total_rounds": 116,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 4026349264896.0,
      "total_flops": 6563399868416.0,
      "flops_per_token": 8052698529.792,
      "peak_memory_mb": 5708.783203125,
      "speedup": 1.0436145508602053
    },
    {
      "method": "Linear K=8",
      "config": {
        "K": 8
      },
      "ttft_ms": 10.04268229007721,
      "tpot_ms": 7.552591757103801,
      "total_latency_ms": 0.0,
      "throughput_tps": 132.05386660551605,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.5580357142857143,
      "tokens_per_round": 4.464285714285714,
      "total_rounds": 112,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 2537050603520,
      "decode_flops": 4443014955008.0,
      "total_flops": 6980065558528.0,
      "flops_per_token": 8886029910.016,
      "peak_memory_mb": 5711.2626953125,
      "speedup": 1.0193825042794706
    },
    {
      "method": "Streaming K=6 cache=1024",
      "config": {
        "K": 6,
        "max_cache_len": 1024
      },
      "ttft_ms": 10.368740372359753,
      "tpot_ms": 7.329579392448068,
      "total_latency_ms": 0.0,
      "throughput_tps": 136.04991314358512,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.6830601092896175,
      "tokens_per_round": 0.0,
      "total_rounds": 0,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 0.0,
      "decode_flops": 0.0,
      "total_flops": 0.0,
      "flops_per_token": 0.0,
      "peak_memory_mb": 5709.0634765625,
      "speedup": 1.0502297640523548
    },
    {
      "method": "Streaming K=6 cache=512",
      "config": {
        "K": 6,
        "max_cache_len": 512
      },
      "ttft_ms": 10.261370986700058,
      "tpot_ms": 7.354249075055122,
      "total_latency_ms": 0.0,
      "throughput_tps": 135.60154629094555,
      "total_tokens_generated": 500,
      "prompt_tokens": 0,
      "total_draft_tokens": 0,
      "total_accepted_tokens": 0,
      "acceptance_rate": 0.6830601092896175,
      "tokens_per_round": 0.0,
      "total_rounds": 0,
      "avg_path_length": 0.0,
      "max_path_length": 0,
      "prefill_flops": 0.0,
      "decode_flops": 0.0,
      "total_flops": 0.0,
      "flops_per_token": 0.0,
      "peak_memory_mb": 5709.0634765625,
      "speedup": 1.046768620983784
    }
  ],
  "acceptance_comparison": {
    "linear_methods": [
      {
        "method": "Linear K=5",
        "acceptance_rate": 0.7246376811594203,
        "tokens_per_round": 3.6231884057971016,
        "total_rounds": 138
      },
      {
        "method": "Linear K=6",
        "acceptance_rate": 0.6830601092896175,
        "tokens_per_round": 4.098360655737705,
        "total_rounds": 122
      },
      {
        "method": "Linear K=7",
        "acceptance_rate": 0.6157635467980296,
        "tokens_per_round": 4.310344827586207,
        "total_rounds": 116
      },
      {
        "method": "Linear K=8",
        "acceptance_rate": 0.5580357142857143,
        "tokens_per_round": 4.464285714285714,
        "total_rounds": 112
      }
    ],
    "tree_methods": [
      {
        "method": "Tree V2 (D=8, B=3, t=0.03)",
        "acceptance_rate": 0.6858710562414266,
        "avg_path_length": 6.172839506172839,
        "total_rounds": 81
      }
    ],
    "analysis": {
      "avg_linear_acceptance_rate": 0.6453742628831954,
      "avg_linear_tokens_per_round": 4.124044900851682,
      "avg_tree_acceptance_rate": 0.6858710562414266,
      "avg_tree_path_length": 6.172839506172839,
      "tree_vs_linear_acceptance_ratio": 1.0627493156874783,
      "explanation": "\nAcceptance Rate Interpretation:\n\nLinear Speculative Decoding:\n- Acceptance Rate = (Total Accepted Tokens) / (Total Draft Tokens)\n- Draft generates K tokens sequentially\n- Accept consecutive tokens until mismatch with target\n- Higher acceptance rate \u2192 more tokens accepted per verification\n\nTree Speculative Decoding:\n- Acceptance Rate = (Accepted Path Tokens) / (Total Tree Nodes)\n- Draft generates a tree of candidates (multiple branches)\n- Only ONE path (longest valid) is accepted\n- Lower raw acceptance rate is expected due to branching\n- Avg Path Length is more meaningful metric for efficiency\n\nKey Insight:\n- Tree methods have lower raw acceptance rates because they generate \n  more candidate tokens (tree nodes) but only accept one path\n- However, the accepted path is often LONGER than linear's acceptance\n- This results in higher throughput despite lower raw acceptance rate\n"
    }
  },
  "rankings": {
    "by_throughput": [
      {
        "rank": 1,
        "method": "Tree V2 (D=8, B=3, t=0.03)",
        "throughput": 171.24889055972693,
        "speedup": 1.3219463193405918
      },
      {
        "rank": 2,
        "method": "HF Assisted",
        "throughput": 158.88808177569246,
        "speedup": 1.2265277410203534
      },
      {
        "rank": 3,
        "method": "Linear K=6",
        "throughput": 136.46178287036892,
        "speedup": 1.0534091695807064
      },
      {
        "rank": 4,
        "method": "Streaming K=6 cache=1024",
        "throughput": 136.04991314358512,
        "speedup": 1.0502297640523548
      },
      {
        "rank": 5,
        "method": "Streaming K=6 cache=512",
        "throughput": 135.60154629094555,
        "speedup": 1.046768620983784
      },
      {
        "rank": 6,
        "method": "Linear K=7",
        "throughput": 135.19295858847372,
        "speedup": 1.0436145508602053
      },
      {
        "rank": 7,
        "method": "Linear K=8",
        "throughput": 132.05386660551605,
        "speedup": 1.0193825042794706
      },
      {
        "rank": 8,
        "method": "Baseline (AR)",
        "throughput": 129.54299887543743,
        "speedup": 1.0
      },
      {
        "rank": 9,
        "method": "Linear K=5",
        "throughput": 128.23325587333503,
        "speedup": 0.9898895114867474
      }
    ],
    "by_acceptance_rate": [
      {
        "rank": 1,
        "method": "Linear K=5",
        "acceptance_rate": 0.7246376811594203
      },
      {
        "rank": 2,
        "method": "Tree V2 (D=8, B=3, t=0.03)",
        "acceptance_rate": 0.6858710562414266
      },
      {
        "rank": 3,
        "method": "Linear K=6",
        "acceptance_rate": 0.6830601092896175
      },
      {
        "rank": 4,
        "method": "Streaming K=6 cache=1024",
        "acceptance_rate": 0.6830601092896175
      },
      {
        "rank": 5,
        "method": "Streaming K=6 cache=512",
        "acceptance_rate": 0.6830601092896175
      },
      {
        "rank": 6,
        "method": "Linear K=7",
        "acceptance_rate": 0.6157635467980296
      },
      {
        "rank": 7,
        "method": "Linear K=8",
        "acceptance_rate": 0.5580357142857143
      }
    ]
  },
  "timestamp": "2026-01-03T15:41:42.843136"
}